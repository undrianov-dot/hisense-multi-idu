# Hisense Multi-IDU Home Assistant Integration

**Hisense Multi-IDU** – пользовательская интеграция для Home Assistant, позволяющая подключить мульти-сплит кондиционеры Hisense к системе умного дома. Интеграция взаимодействует с локальным контроллером по IP (например, `10.99.3.100`), получая данные через REST API и управляя внутренними блоками кондиционеров.

## Возможности

- **16 климатических сущностей** – интеграция автоматически создает по одной Climate-сущности для каждого внутреннего блока (IDU). Идентификаторы этих сущностей имеют формат `climate.idu_sX_Y_Z` (например, `climate.idu_s1_1_2`, `climate.idu_s2_8_2` и т.д.).
- **Полное управление кондиционерами** – поддерживаются основные функции: включение/выключение, выбор режима работы (авто, охлаждение, обогрев, осушение, вентиляция), установка температуры, регулировка скорости вентилятора. Все команды отправляются контроллеру незамедлительно, и интеграция запрашивает обновленные данные для моментального отображения изменений в Home Assistant.
- **Датчик энергопотребления** – интеграция добавляет Sensor-сущность `sensor.hisense_meter_energy` (\"Hisense электросчётчик\"), показывающую суммарно потребленную электроэнергию (в кВт·ч) по данным встроенного счетчика контроллера. Датчик настроен с классом измерения энергии (`energy`) и типом счётчика `total_increasing` для корректного расчета расхода.
- **DataUpdateCoordinator** – для эффективного опроса используется механизм координации обновлений. Все 16 блоков опрашиваются одним запросом, что снижает нагрузку. Интервал опроса настраивается по умолчанию в коде (30 секунд для состояний кондиционеров и 60 секунд для счетчика энергии), при необходимости можно изменить.
- **Настройка через UI** – интеграция поддерживает `Config Flow` и полностью настраивается через интерфейс Home Assistant. Достаточно добавить новую интеграцию \"Hisense Multi-IDU\" и указать IP-адрес контроллера. После этого устройства будут настроены автоматически. (Использование YAML не требуется.)
- **Совместимость с HACS** – репозиторий совместим с Home Assistant Community Store, что упрощает установку и обновления. Достаточно добавить данный репозиторий в HACS и установить интеграцию.

## Установка и настройка

1. **Установка через HACS:** Добавьте репозиторий `undrianov-dot/hisense-multi-idu` в HACS (раздел *Custom repositories*). Установите интеграцию **Hisense Multi-IDU**.
2. **Активирование интеграции:** Перезапустите Home Assistant, затем в веб-интерфейсе перейдите в Настройки -> Устройства и службы -> Добавить интеграцию. Найдите в списке **Hisense Multi-IDU**.
3. **Добавление контроллера:** Введите IP-адрес контроллера Hisense (например, `10.99.3.100`) в появившейся форме. При корректном подключении интеграция автоматически создаст все необходимые сущности.
4. **Готово:** В списке устройств Home Assistant появится новый контроллер \"Hisense Multi-IDU Controller <IP>\" с привязанными к нему климатическими устройствами (16 внутренних блоков) и датчиком энергопотребления. Вы можете переименовать устройства или расположить их по зонам (комнатам) по своему усмотрению.

## Примечания

- Для работы интеграции контроллер Hisense Multi-IDU должен быть подключен к локальной сети и доступен по указанному IP-адресу. Убедитесь, что Home Assistant имеет сетевой доступ к подсети контроллера.
- Если интеграция не может получить данные (например, неверный IP или контроллер недоступен), будет показано соответствующее уведомление в процессе настройки. Проверьте подключение и повторите попытку.
- В логе Home Assistant (при уровне debug для данного компонента) можно увидеть отладочную информацию, включая сырые данные от контроллера и отправляемые команды, что может помочь при диагностике проблем.

## Благодарности

Данная интеграция разработана специально для систем Hisense Multi-IDU. Если вы обнаружили ошибку или у вас есть предложения по улучшению, пожалуйста, создайте issue в репозитории. Contributions приветствуются!
